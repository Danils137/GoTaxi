# 🏛️ Архитектура многоуровневой админ панели GoTaxi

## 📋 Содержание
1. [Типы пользователей](#типы-пользователей)
2. [Система ролей и разрешений](#система-ролей-и-разрешений)
3. [Интерфейсы по ролям](#интерфейсы-по-ролям)
4. [Система отчетности](#система-отчетности)
5. [Интеграция с государственными системами](#интеграция-с-государственными-системами)
6. [Безопасность и аудит](#безопасность-и-аудит)

---

## 👥 Типы пользователей

### 1. 🏢 **Сотрудники GoTaxi**
**Роли:**
- **Super Admin** - полный доступ ко всем функциям
- **Operations Manager** - управление операциями и водителями
- **Support Agent** - поддержка клиентов и водителей
- **Finance Manager** - финансовая отчетность и тарифы
- **Marketing Manager** - промо-акции и аналитика

**Полномочия:**
- ✅ Управление всеми пользователями системы
- ✅ Модерация тарифов и водителей
- ✅ Финансовая отчетность
- ✅ Настройка системных параметров
- ✅ Техническая поддержка
- ✅ Маркетинговые кампании

### 2. 🚗 **Владельцы автопарков / Компании**
**Роли:**
- **Fleet Owner** - владелец автопарка
- **Fleet Manager** - менеджер автопарка
- **Fleet Dispatcher** - диспетчер

**Полномочия:**
- ✅ Управление своими водителями
- ✅ Просмотр статистики своего автопарка
- ✅ Финансовая отчетность по своим водителям
- ✅ Настройка тарифов для своих водителей
- ❌ Доступ к данным других автопарков
- ❌ Системные настройки

### 3. 🏛️ **Государственные контролеры**
**Роли:**
- **Tax Inspector** - налоговый инспектор
- **Transport Regulator** - регулятор транспорта
- **Safety Inspector** - инспектор безопасности
- **Data Protection Officer** - офицер защиты данных

**Полномочия:**
- ✅ Просмотр отчетов для налогообложения
- ✅ Контроль соблюдения лицензионных требований
- ✅ Аудит безопасности и качества услуг
- ✅ Экспорт данных для государственных систем
- ❌ Изменение настроек системы
- ❌ Доступ к персональным данным без ордера

### 4. 🔍 **Аудиторы и аналитики**
**Роли:**
- **Internal Auditor** - внутренний аудитор
- **Data Analyst** - аналитик данных
- **Compliance Officer** - офицер соответствия

**Полномочия:**
- ✅ Просмотр всех логов и аудит-трейлов
- ✅ Аналитические отчеты
- ✅ Контроль соответствия регулированию
- ❌ Изменение данных
- ❌ Доступ к персональным данным клиентов

---

## 🔐 Система ролей и разрешений

### Иерархия ролей

```
Super Admin
├── Operations Manager
│   ├── Support Agent
│   └── Fleet Manager
│       └── Fleet Dispatcher
├── Finance Manager
├── Marketing Manager
└── Compliance Officer
    ├── Internal Auditor
    ├── Tax Inspector
    ├── Transport Regulator
    └── Safety Inspector
```

### Матрица разрешений

| Функция | Super Admin | Ops Manager | Support | Finance | Fleet Owner | Tax Inspector | Transport Reg |
|---------|-------------|-------------|---------|---------|-------------|---------------|---------------|
| **Пользователи** |
| Создание пользователей | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Блокировка пользователей | ✅ | ✅ | ✅ | ❌ | ⚠️* | ❌ | ❌ |
| Просмотр профилей | ✅ | ✅ | ✅ | ❌ | ⚠️* | ⚠️** | ⚠️** |
| **Водители** |
| Одобрение водителей | ✅ | ✅ | ❌ | ❌ | ⚠️* | ❌ | ✅ |
| Блокировка водителей | ✅ | ✅ | ✅ | ❌ | ⚠️* | ❌ | ✅ |
| Просмотр документов | ✅ | ✅ | ✅ | ❌ | ⚠️* | ✅ | ✅ |
| **Тарифы** |
| Модерация тарифов | ✅ | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| Установка лимитов | ✅ | ✅ | ❌ | ✅ | ❌ | ❌ | ✅ |
| **Финансы** |
| Финансовые отчеты | ✅ | ✅ | ❌ | ✅ | ⚠️* | ✅ | ❌ |
| Налоговые отчеты | ✅ | ❌ | ❌ | ✅ | ⚠️* | ✅ | ❌ |
| Управление выплатами | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ |
| **Система** |
| Системные настройки | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Логи и аудит | ✅ | ✅ | ❌ | ❌ | ❌ | ✅ | ✅ |
| Резервное копирование | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |

**Легенда:**
- ✅ Полный доступ
- ❌ Доступ запрещен
- ⚠️* Только для своего автопарка
- ⚠️** Только с судебным ордером или по запросу

---

## 🖥️ Интерфейсы по ролям

### 1. 🏢 **Панель сотрудников GoTaxi**

#### **Super Admin Dashboard**
```
📊 Общая статистика
├── 👥 Активные пользователи: 15,234
├── 🚗 Активные водители: 2,456
├── 💰 Дневной оборот: €45,678
└── 📈 Рост за месяц: +12%

🛠️ Быстрые действия
├── 👤 Управление пользователями
├── 🚗 Модерация водителей
├── 💰 Финансовые операции
├── ⚙️ Системные настройки
└── 📊 Аналитика и отчеты

🚨 Критические уведомления
├── ⚠️ 3 водителя ожидают модерации
├── 💳 Проблема с платежной системой
└── 📋 Новый запрос от регулятора
```

#### **Operations Manager Dashboard**
```
🚗 Управление операциями
├── 👥 Водители на линии: 1,234
├── 🚖 Активные поездки: 456
├── ⏱️ Среднее время ожидания: 4.2 мин
└── 📍 Покрытие по районам: 98%

📋 Задачи на сегодня
├── ✅ Одобрить 12 новых водителей
├── 🔍 Проверить 5 жалоб
├── 📊 Подготовить недельный отчет
└── 🚨 Решить 3 критических инцидента

📈 Ключевые метрики
├── 🎯 Конверсия заказов: 89%
├── ⭐ Средний рейтинг: 4.7
└── 💰 Средний чек: €18.50
```

### 2. 🚗 **Панель владельцев автопарков**

#### **Fleet Owner Dashboard**
```
🏢 Автопарк "Рига Такси"
├── 🚗 Всего автомобилей: 45
├── 👥 Активных водителей: 38
├── 💰 Доход за месяц: €23,456
└── 📈 Рост: +8%

📊 Статистика водителей
├── 🥇 Лучший: Андрей П. (€1,234)
├── ⭐ Средний рейтинг: 4.6
├── 🚖 Поездок за день: 234
└── ⏱️ Среднее время на линии: 8.5ч

💰 Финансы
├── 💵 Доход сегодня: €1,234
├── 💳 К выплате водителям: €987
├── 🏛️ Комиссия GoTaxi: €247
└── 📊 Прибыль: €543

🛠️ Управление
├── ➕ Добавить водителя
├── 📋 Управление тарифами
├── 📊 Детальная аналитика
└── 💬 Связь с водителями
```

### 3. 🏛️ **Панель государственных контролеров**

#### **Tax Inspector Dashboard**
```
🏛️ Налоговая инспекция - Панель контроля

📊 Налоговая отчетность
├── 💰 НДС за месяц: €45,678
├── 🏢 Подоходный налог: €23,456
├── 📋 Количество деклараций: 2,456
└── ⚠️ Нарушения: 12

🔍 Контрольные функции
├── 📊 Экспорт данных в ГНС
├── 🔍 Аудит транзакций
├── 📋 Проверка деклараций
└── 🚨 Выявление нарушений

📈 Статистика по регионам
├── 🏙️ Рига: €34,567 (76%)
├── 🏘️ Даугавпилс: €7,890 (17%)
├── 🌊 Лиепая: €2,345 (5%)
└── 🌲 Другие: €876 (2%)

⚠️ Требуют внимания
├── 🚨 3 водителя с подозрительными доходами
├── 📋 5 компаний не подали декларации
└── 💰 Расхождения в отчетах: €1,234
```

#### **Transport Regulator Dashboard**
```
🚛 Регулятор транспорта - Контрольная панель

📋 Лицензионный контроль
├── ✅ Действующие лицензии: 2,234
├── ⏳ На рассмотрении: 45
├── ❌ Отозванные: 12
└── ⚠️ Истекают в течение месяца: 67

🔍 Контроль качества
├── ⭐ Средний рейтинг сервиса: 4.6
├── 📞 Жалобы за месяц: 23
├── 🚗 Проверки автомобилей: 156
└── 📋 Нарушения ПДД: 8

📊 Соответствие требованиям
├── 🛡️ Страхование: 98% соответствие
├── 🔧 Техосмотр: 95% соответствие
├── 👨‍⚕️ Медосмотр водителей: 97%
└── 📚 Обучение: 89% соответствие

🚨 Критические нарушения
├── ⚠️ 2 водителя без действующих прав
├── 🚗 5 автомобилей с просроченным техосмотром
└── 📋 3 компании нарушили тарифное регулирование
```

---

## 📊 Система отчетности

### 1. **Финансовые отчеты**

#### Для GoTaxi (внутренние)
```
💰 Финансовый отчет - Январь 2025
├── 📈 Общий оборот: €456,789
├── 💳 Комиссионные доходы: €91,358 (20%)
├── 💸 Операционные расходы: €34,567
├── 💰 Чистая прибыль: €56,791
└── 📊 Рентабельность: 12.4%

📋 Детализация по источникам
├── 🚗 Комиссия с поездок: €78,456 (86%)
├── 📱 Подписки водителей: €8,902 (10%)
├── 📊 Премиум функции: €2,345 (3%)
└── 🎯 Реклама: €1,655 (1%)
```

#### Для налоговой
```
🏛️ Налоговый отчет - Январь 2025
├── 💰 Налогооблагаемая база: €456,789
├── 📊 НДС (21%): €95,926
├── 🏢 Подоходный налог (20%): €11,358
├── 👥 Социальные взносы: €15,678
└── 💳 Всего к доплате: €122,962

📋 Детализация по водителям
├── 👥 Всего водителей: 2,456
├── 💰 Средний доход: €186/месяц
├── 🏛️ Средний налог: €37/месяц
└── 📊 Соответствие: 98.5%
```

### 2. **Операционные отчеты**

#### Для регулятора транспорта
```
🚛 Операционный отчет - Январь 2025
├── 🚖 Всего поездок: 45,678
├── 👥 Уникальных пассажиров: 23,456
├── 🚗 Активных водителей: 2,234
├── ⏱️ Среднее время поездки: 18 мин
└── 📍 Средняя дистанция: 8.5 км

📊 Качество сервиса
├── ⭐ Средний рейтинг: 4.6/5
├── 📞 Жалобы: 23 (0.05%)
├── ⏱️ Время ожидания: 4.2 мин
└── 🎯 Успешность заказов: 94%

🛡️ Безопасность
├── 🚨 ДТП с участием такси: 2
├── 👮 Нарушения ПДД: 8
├── 🔍 Проверки документов: 156
└── ⚠️ Выявленные нарушения: 5
```

### 3. **Аналитические отчеты**

#### Для владельцев автопарков
```
📊 Аналитика автопарка "Рига Такси" - Январь 2025
├── 💰 Общий доход: €23,456
├── 🚗 Средний доход на авто: €521
├── 👥 Средний доход водителя: €617
└── 📈 Рост относительно прошлого месяца: +8%

🎯 Эффективность
├── 🚖 Поездок на водителя/день: 12.3
├── ⏱️ Время на линии: 8.5ч
├── 💰 Доход за час: €7.25
└── ⭐ Средний рейтинг: 4.6

🏆 Топ водители
├── 🥇 Андрей П.: €1,234 (156 поездок)
├── 🥈 Мария К.: €1,156 (142 поездки)
└── 🥉 Петр С.: €1,089 (134 поездки)
```

---

## 🔗 Интеграция с государственными системами

### 1. **Налоговая служба (VID)**
```
🏛️ Интеграция с VID
├── 📊 Автоматическая передача данных о доходах
├── 💰 Расчет и уплата НДС
├── 📋 Электронные декларации
└── 🔍 Предоставление данных по запросам
```

### 2. **Дорожная полиция (CSDD)**
```
🚔 Интеграция с CSDD
├── 🚗 Проверка действительности водительских прав
├── 📋 Верификация техосмотра автомобилей
├── 🛡️ Проверка страховки
└── 📊 Отчеты о нарушениях ПДД
```

### 3. **Министерство транспорта**
```
🏛️ Интеграция с Минтранс
├── 📋 Лицензионные данные
├── 📊 Статистика пассажироперевозок
├── 🎯 Соответствие тарифному регулированию
└── 📈 Аналитика развития отрасли
```

---

## 🔒 Безопасность и аудит

### 1. **Система аудита**
```
📋 Аудит-лог
├── 👤 Пользователь: admin@gotaxi.lv
├── ⏰ Время: 2025-01-19 14:30:15
├── 🎯 Действие: Одобрение водителя
├── 📊 Объект: driver_12345
├── 🌐 IP: 192.168.1.100
└── 📱 User-Agent: Chrome/120.0
```

### 2. **Контроль доступа**
```
🔐 Система безопасности
├── 🔑 Двухфакторная аутентификация
├── 🕐 Сессии с тайм-аутом
├── 🌐 IP-ограничения для критических ролей
├── 📊 Мониторинг подозрительной активности
└── 🔒 Шифрование всех данных
```

### 3. **Соответствие GDPR**
```
🛡️ Защита данных (GDPR)
├── 📋 Согласие на обработку данных
├── 🗑️ Право на удаление данных
├── 📊 Портативность данных
├── 🔍 Уведомления о нарушениях
└── 👨‍💼 Назначенный DPO
```

---

## 🚀 Техническая реализация

### 1. **Архитектура ролей (Backend)**
```javascript
// Модель пользователя с ролями
const UserSchema = {
  email: String,
  role: {
    type: String,
    enum: ['super_admin', 'ops_manager', 'support', 'finance', 
           'fleet_owner', 'fleet_manager', 'tax_inspector', 
           'transport_regulator', 'safety_inspector']
  },
  permissions: [String],
  organization: String, // Для автопарков и гос. органов
  accessLevel: Number,  // 1-10, где 10 - максимальный доступ
  lastLogin: Date,
  ipRestrictions: [String]
}
```

### 2. **Middleware авторизации**
```javascript
const checkPermission = (requiredPermission) => {
  return (req, res, next) => {
    const user = req.user;
    
    if (!user.permissions.includes(requiredPermission)) {
      return res.status(403).json({
        error: 'Недостаточно прав доступа'
      });
    }
    
    // Логирование действия
    auditLog.create({
      userId: user.id,
      action: requiredPermission,
      timestamp: new Date(),
      ip: req.ip,
      userAgent: req.get('User-Agent')
    });
    
    next();
  };
};
```

### 3. **Компонентная архитектура (Frontend)**
```typescript
// Компонент с проверкой ролей
interface RoleGuardProps {
  requiredRole: UserRole;
  requiredPermission?: string;
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

const RoleGuard: React.FC<RoleGuardProps> = ({
  requiredRole,
  requiredPermission,
  children,
  fallback
}) => {
  const { user } = useAuth();
  
  const hasAccess = user.role === requiredRole || 
    (requiredPermission && user.permissions.includes(requiredPermission));
  
  return hasAccess ? children : (fallback || <AccessDenied />);
};
```

---

## 📱 Мобильная версия

### Адаптация для мобильных устройств
```
📱 Мобильная админ панель
├── 🚨 Push-уведомления о критических событиях
├── 📊 Упрощенная аналитика
├── 👥 Быстрое управление водителями
├── 💬 Чат с поддержкой
└── 📍 GPS-мониторинг автопарка
```

---

## 🔮 Будущие улучшения

### 1. **Искусственный интеллект**
- 🤖 Автоматическое выявление мошенничества
- 📊 Предиктивная аналитика
- 🎯 Персонализированные рекомендации

### 2. **Интеграции**
- 🏦 Банковские API для автоматических выплат
- 📱 Интеграция с государственными мобильными приложениями
- 🌐 API для сторонних аналитических систем

### 3. **Расширенная аналитика**
- 📈 Машинное обучение для прогнозирования спроса
- 🎯 Оптимизация маршрутов и ценообразования
- 📊 Бизнес-интеллект для принятия решений

---

*Документация обновлена: 19 января 2025*
*Версия системы: 1.0*

